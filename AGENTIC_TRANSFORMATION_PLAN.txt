================================================================================
         AGENTIC STRATEGY 2: AI-POWERED TITLE OPTIMIZATION PLAN
================================================================================

DATE: 26 December 2025
PROJECT: Amazon Title Optimizer - Agentic Strategy 2
GOAL: Transform rule-based system into AI-powered decision engine using Ollama

================================================================================
PART 1: CURRENT SYSTEM ANALYSIS
================================================================================

CURRENT ARCHITECTURE:
--------------------
The system uses a COMPLEX RULE-BASED PIPELINE with 10+ steps:

1. Parser → Extracts concepts (Brand, Product, Size, Color, Fragrance, etc.)
2. Implication Rules → Removes redundant concepts (Fragrance implies Scent)
3. Quality Marker Removal → Removes "Premium", "Deluxe" (hard-coded)
4. Semantic Grouping → Groups similar concepts
5. Synonym Capping → Limits to 1 synonym
6. Feature Capping → Limits to 3 features
7. Redundancy Removal → Manual deduplication logic
8. Zone Building → 40%-40%-20% zones (A=decision, B=SEO, C=details)
9. Knapsack Eviction → Budget-based removal
10. Keyword Enrichment → Vector DB search with 20+ hardcoded filters

CURRENT PROBLEMS (As Identified):
---------------------------------
❌ TOO COMPLEX: Over-engineered with hardcoded rules
❌ NOT GENERALIZABLE: Works for garbage bags, fails for other categories
❌ REMOVES "PREMIUM" ALWAYS: Even when justified
❌ REMOVES "SCENTED" ALWAYS: Even when it's a key search term
❌ HARDCODED FILTERS: 
   - Material phrase preservation (manual list)
   - Context group detection (vehicle/home/baby/pet)
   - Low-signal modifier filtering
   - Spelling normalization
   - Quality marker blocking
❌ RIGID ZONE STRUCTURE: Forces 40-40-20 regardless of product
❌ PIPES NOT NECESSARY: User doesn't want "|" separators

CURRENT STRENGTHS:
-----------------
✅ Vector DB Integration: SentenceTransformers embeddings (153k keywords)
✅ Ollama Setup: Local LLM already installed (gpt-oss:20b-cloud)
✅ AI Validator Started: Basic keyword validation exists
✅ Scoring Logic: Clicks Rank (50%) + Search Volume Rank (50%)
✅ Truth-based filtering: Strips conflicting attributes


================================================================================
PART 2: USER REQUIREMENTS (YOUR VISION)
================================================================================

CORE PRINCIPLES:
---------------
1. FIRST 40% = DECISION ZONE
   → User sees this first, decides whether to click
   → Pack maximum information in best SEO order
   → Order based on MOST SEARCHED KEYWORDS (not arbitrary rules)
   → Color NOT mandatory here (visible in image)

2. NEXT 40% = PURE SEO ZONE
   → Purely keyword-driven
   → Can REPEAT important attributes if highly searched
   → Example: "Medium" can appear twice if it's top search term

3. LAST 20% = DETAILS/VARIANTS ZONE
   → Additional features, use cases, synonyms

4. "PREMIUM" & "SCENTED" HANDLING:
   → DON'T blindly remove
   → Use AI to decide: "Is Premium/Scented valuable here?"
   → Premium can be added to ANY product (it's marketing, not truth)
   → Scented is valuable even with "Lavender Fragrance"

5. GENERALIZATION ACROSS CATEGORIES:
   → Same algorithm for garbage bags, bike parts, furniture, etc.
   → Let AI understand category-specific patterns
   → No hardcoded automotive/home/baby context rules

6. NO PIPES:
   → Don't force "|" separators (waste chars)
   → Use natural phrasing

7. EXAMPLE EXCELLENCE:
   ORIGINAL: Shalimar Premium (Lavender Fragrance) Scented Garbage Bags | 
             Medium 19 X 21 Inches | 120 Bags (30 Bags X 4 Rolls) | 
             Dustbin Bag/Trash Bag | (Black) - Perforated Box for Easy Dispensing

   IDEAL:    Shalimar Scented Garbage Bags Medium 19x21" 120(30bags x 4rolls), 
             Premium Black Dustbin Bags Medium Size for Kitchen with Lavender Fragrance
   
   WHY IDEAL:
   - First 40%: "Shalimar Scented Garbage Bags Medium 19x21" 120" 
                 → Brand, Product, Key Feature, Size, Count (decision-critical)
   - Next 40%: "(30bags x 4rolls), Premium Black Dustbin Bags Medium Size"
                 → SEO repetition (Medium appears twice), color, synonym
   - Last 20%: "for Kitchen with Lavender Fragrance"
                 → Use case, fragrance detail


================================================================================
PART 3: WHY AI? (AGENTIC APPROACH JUSTIFICATION)
================================================================================

WHAT PROGRAMMING CANNOT DO ALONE:
---------------------------------
1. KEYWORD ORDERING INTELLIGENCE:
   ❌ Rule: "Brand → Product → Size → Color → Count"
   ✅ AI: "What's the most searched sequence for THIS product?"
          → Garbage bags: "scented" before "medium" (fragrance drives search)
          → Car parts: "compatibility" before "brand" (fitment critical)

2. CONTEXT-AWARE QUALITY MARKERS:
   ❌ Rule: "Always remove Premium"
   ✅ AI: "For luxury bags: keep Premium. For basic products: remove"

3. REPETITION DECISIONS:
   ❌ Rule: "Never repeat words"
   ✅ AI: "Medium appears in top 5 searches → repeat it"

4. CATEGORY GENERALIZATION:
   ❌ Rule: Hardcode automotive/home/baby context detection
   ✅ AI: Understand ANY product category from title + truth

5. NATURAL PHRASING:
   ❌ Rule: "Brand | Product | Size" (rigid template)
   ✅ AI: "Shalimar Scented Garbage Bags Medium" (natural flow)

6. REDUNDANCY VS VALUE:
   ❌ Rule: "Scented redundant with Lavender Fragrance"
   ✅ AI: "'Scented' is a high-volume search term → keep it even with fragrance detail"


================================================================================
PART 4: AGENTIC ARCHITECTURE (NEW DESIGN)
================================================================================

HIGH-LEVEL FLOW:
---------------
                    ┌─────────────────┐
                    │  INPUT: Title   │
                    │  + Truth Dict   │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │ STEP 1: PARSE   │ ← AI-Assisted
                    │ Extract Concepts│   (category detection)
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │ STEP 2: ENRICH  │ ← AI-Driven
                    │ Vector DB Search│   (keyword ranking)
                    │ + AI Validation │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │ STEP 3: DECIDE  │ ← PURE AI
                    │ AI Title Builder│   (ordering, zones, repetition)
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │ STEP 4: RENDER  │ ← Simple formatter
                    │ Format & Polish │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │ OUTPUT: Optimal │
                    │   Amazon Title  │
                    └─────────────────┘


DETAILED AGENT ROLES:
---------------------

AGENT 1: CATEGORY DETECTOR
---------------------------
Input: Title + Truth
Task: Identify product category and key characteristics
Output: {
    "category": "home_storage",
    "subcategory": "garbage_bags",
    "key_attributes": ["scented", "medium", "kitchen"],
    "search_priorities": ["scent", "size", "room", "count"]
}
Why: Generalizes across categories without hardcoded rules

AGENT 2: KEYWORD RANKER
------------------------
Input: Product context + Vector DB candidates
Task: Rank keywords by search value + relevance
Output: [
    {"keyword": "scented garbage bags", "score": 0.95, "priority": "high"},
    {"keyword": "medium dustbin bags", "score": 0.88, "priority": "high"},
    {"keyword": "kitchen trash bags", "score": 0.72, "priority": "medium"},
    ...
]
Why: Replaces 20+ hardcoded filters with intelligent ranking

AGENT 3: CONCEPT EVALUATOR
---------------------------
Input: Concept (e.g., "Premium"), Product context
Task: Decide keep/remove + value score
Output: {
    "concept": "Premium",
    "action": "keep",
    "reason": "high-end product with premium pricing",
    "position": "mid_title",  # not first 40%
    "value_score": 0.65
}
Why: Context-aware decisions vs blind removal

AGENT 4: ZONE OPTIMIZER (CORE AI AGENT)
----------------------------------------
Input: All validated concepts + keyword priorities + truth
Task: Build optimal 3-zone structure with search-driven ordering
Constraints:
- First ~80 chars (40%): Decision-critical info in search-optimal order
- Next ~80 chars (40%): SEO keywords, repetition allowed if high-value
- Last ~40 chars (20%): Details, variants, low-priority features
- Max 200 chars total
- Color can be anywhere (not forced to first 40%)

Prompt Structure:
"""
You are an Amazon title optimization expert specializing in search-driven ordering.

PRODUCT CONTEXT:
- Category: {category}
- Brand: {brand}
- Product: {product}
- Key Truth: {size, color, count, features}

AVAILABLE CONCEPTS (ranked by search volume):
1. scented (Clicks Rank: 2, Search Volume Rank: 3) - HIGH PRIORITY
2. medium (Clicks Rank: 1, Search Volume Rank: 5) - HIGH PRIORITY
3. garbage bags (Clicks Rank: 1, Search Volume Rank: 1) - CRITICAL
4. 120 bags (Clicks Rank: 8, Search Volume Rank: 12) - MEDIUM
5. lavender fragrance (Clicks Rank: 15, Search Volume Rank: 20) - LOW
6. black (Clicks Rank: 18, Search Volume Rank: 25) - LOW (visible in image)
7. premium (Clicks Rank: 22, Search Volume Rank: 30) - LOW
...

VALIDATED KEYWORDS (from vector DB):
- "scented garbage bags medium" (similarity: 0.92, clicks_rank: 1)
- "medium dustbin bags" (similarity: 0.88, clicks_rank: 3)
- "kitchen trash bags" (similarity: 0.85, clicks_rank: 5)
...

TASK: Build a 200-char Amazon title with 3 zones:

ZONE 1 (40% = ~80 chars): DECISION ZONE
- Pack max info for click decision
- Order by SEARCH PRIORITY (not alphabetical)
- Example: "Shalimar Scented Garbage Bags Medium 19x21" 120 Bags"
- Rules:
  * Brand first (if strong brand)
  * Then highest-priority search terms
  * Size/count if decision-critical
  * Color optional (user sees image)

ZONE 2 (40% = ~80 chars): SEO ZONE
- Pure keyword optimization
- REPETITION ALLOWED if keyword is top-ranked
- Example: "(30x4 Rolls) Premium Black Dustbin Bags Medium Size for Kitchen"
- Rules:
  * Repeat high-value attributes (e.g., "Medium" twice)
  * Synonyms for search coverage (Dustbin Bags, Trash Bags)
  * Room/use-case if highly searched

ZONE 3 (20% = ~40 chars): DETAILS ZONE
- Additional features, fragrance details
- Example: "with Lavender Fragrance"

CRITICAL RULES:
1. NO PIPES (|) - use commas, natural phrasing
2. Don't force color into first 40% (it's in the image)
3. Repeat important terms if they're top-searched
4. Natural flow: "Scented Garbage Bags" not "Garbage Bags Scented"
5. Keep Premium/Scented if valuable for THIS product
6. Prioritize clicks_rank over search_volume_rank (clicks = demand)

OUTPUT (JSON):
{
    "zone_a": "Shalimar Scented Garbage Bags Medium 19x21\\" 120 Bags",
    "zone_b": "(30x4 Rolls) Premium Black Dustbin Bags Medium Size for Kitchen",
    "zone_c": "with Lavender Fragrance, Perforated Dispenser",
    "full_title": "Shalimar Scented Garbage Bags Medium 19x21\\" 120 Bags (30x4 Rolls) Premium Black Dustbin Bags Medium Size for Kitchen with Lavender Fragrance, Perforated Dispenser",
    "length": 178,
    "reasoning": {
        "zone_a_order": "Brand → Scented (Clicks#2) → Product → Size → Count",
        "repetitions": ["Medium appears twice - Clicks Rank #1 search term"],
        "premium_kept": "Product is premium-priced, Premium adds value",
        "color_zone_b": "Black moved to Zone B - visible in image, lower search priority"
    }
}
"""

Why: Single AI call replaces entire zone_builder + renderer + ordering logic


AGENT 5: VALIDATOR & POLISHER
------------------------------
Input: AI-generated title
Task: Final checks (length, policy, truth alignment)
Output: Polished title OR refinement suggestions
Why: Catch AI hallucinations, ensure truth alignment


================================================================================
PART 5: IMPLEMENTATION ROADMAP
================================================================================

PHASE 1: MINIMAL AI INTEGRATION (QUICK WIN)
-------------------------------------------
Timeline: 2-3 hours
Goal: Make existing system more intelligent without full rewrite

Changes:
1. Replace hardcoded Quality Marker removal with AI decision:
   - Query: "Should we keep 'Premium' for {product}?"
   - Fast Ollama call (20b-cloud model)

2. Replace hardcoded Scented removal with AI decision:
   - Query: "Is 'Scented' valuable even with 'Lavender Fragrance'?"

3. Enhance AI Validator for keyword ranking:
   - Add search volume context to prompts
   - Return priority score (not just yes/no)

4. AI-assisted Zone A ordering:
   - Query: "Best order for Zone A: {concepts}"
   - Returns ordered list based on search patterns

Result: 30-40% improvement with minimal code changes


PHASE 2: AGENTIC ZONE BUILDER (CORE TRANSFORMATION)
---------------------------------------------------
Timeline: 4-6 hours
Goal: Replace zone_builder + renderer with AI-driven logic

New File: agentic_zone_builder.py

Key Functions:
1. build_title_with_ai(concepts, keywords, truth, vector_db_results)
   → Single AI call to build full title
   → Replaces 10+ rule-based steps

2. validate_and_refine(ai_title, truth)
   → Check length, truth alignment, policy
   → Request refinement if needed

3. explain_title_decisions(title, reasoning)
   → Return structured explanation for user review

Integration:
- Keep parser (still useful for concept extraction)
- Keep vector DB (provides search data)
- Replace Steps 3-10 with agentic_zone_builder

Result: 60-70% improvement, fully generalizable


PHASE 3: CATEGORY-AWARE OPTIMIZATION (FULL AGENTIC)
---------------------------------------------------
Timeline: 6-8 hours
Goal: Automatic category detection + optimization

New Capabilities:
1. Auto-detect category from title (no hardcoded rules)
2. Category-specific search patterns (learned from vector DB)
3. Dynamic zone sizing (40-40-20 not always optimal)
4. Multi-language support (if vector DB has international data)

Result: 80-90% improvement, works for ANY product category


================================================================================
PART 6: OLLAMA PROMPT ENGINEERING (CRITICAL SUCCESS FACTOR)
================================================================================

PROMPT DESIGN PRINCIPLES:
-------------------------
1. STRUCTURED OUTPUT: Always request JSON
2. FEW-SHOT EXAMPLES: Show 2-3 ideal transformations
3. SEARCH DATA: Include clicks_rank + search_volume_rank
4. CLEAR CONSTRAINTS: Max chars, no pipes, repetition rules
5. REASONING REQUIRED: Ask AI to explain decisions
6. TEMPERATURE: 0.1-0.3 (deterministic, not creative)

EXAMPLE PROMPT (Zone Optimizer):
---------------------------------
See detailed prompt in AGENT 4 section above.

PROMPT TESTING STRATEGY:
------------------------
1. Test with 10 diverse products (garbage bags, bike parts, furniture, etc.)
2. Compare AI output vs rule-based output
3. Measure:
   - Character efficiency
   - Keyword coverage
   - Natural readability
   - Search term priority alignment
4. Iterate on prompt until 80%+ improvement


================================================================================
PART 7: RISK MITIGATION
================================================================================

RISK 1: AI Hallucination
-------------------------
Problem: AI invents non-existent features
Solution:
- Strict truth validation (final check)
- Only allow concepts from parsed title + vector DB
- Reject titles with unknown words

RISK 2: Inconsistent Output
----------------------------
Problem: AI produces different titles each run
Solution:
- Low temperature (0.1)
- Seed parameter (if Ollama supports)
- Structured JSON output (easier to validate)

RISK 3: Slow Performance
-------------------------
Problem: AI calls add latency
Solution:
- Cache category detection (same product → same category)
- Batch process multiple titles
- Use faster Ollama model for non-critical decisions

RISK 4: Over-reliance on AI
----------------------------
Problem: AI makes poor decisions for edge cases
Solution:
- Keep truth-based hard constraints
- Human review mode (show AI reasoning)
- Fallback to rule-based if AI fails


================================================================================
PART 8: SUCCESS METRICS
================================================================================

BEFORE (Rule-Based):
-------------------
- 153k keywords ingested
- 20+ hardcoded filters
- 10-step pipeline
- Works for 2-3 categories
- Manual tuning for each category
- Removes Premium/Scented blindly

AFTER (Agentic):
----------------
- Same 153k keywords (data reuse)
- 5 AI agents replace 90% of rules
- 4-step pipeline
- Works for 100+ categories
- Zero manual tuning
- Context-aware Premium/Scented decisions
- Search-driven keyword ordering
- Natural phrasing (no pipes)
- Repetition when valuable

MEASURABLE IMPROVEMENTS:
-----------------------
1. Generalization: Works for any category (not just garbage bags)
2. Accuracy: 80%+ match to ideal human-written titles
3. Search Optimization: Top keywords in first 40%
4. Character Efficiency: 10-15% more keywords per title
5. Readability: Natural flow vs template rigidity


================================================================================
PART 9: RECOMMENDED NEXT STEPS
================================================================================

IMMEDIATE ACTION (Start Today):
-------------------------------
1. Create agentic_zone_builder.py (skeleton)
2. Write Zone Optimizer prompt (use template above)
3. Test on 5 sample products (garbage bags, bike parts, etc.)
4. Compare output quality vs current system
5. Iterate on prompt based on results

WEEK 1 GOALS:
-------------
- Phase 1 complete (AI-enhanced decisions)
- 30-40% quality improvement
- Works for 5+ categories

WEEK 2 GOALS:
-------------
- Phase 2 complete (Agentic Zone Builder)
- 60-70% quality improvement  
- Works for 20+ categories

MONTH 1 GOALS:
--------------
- Phase 3 complete (Full Agentic System)
- 80-90% quality improvement
- Works for ANY category
- Production-ready


================================================================================
PART 10: KEY INSIGHTS & PHILOSOPHY
================================================================================

THE CORE PROBLEM:
-----------------
"You cannot hardcode search behavior patterns."

Every product category has different search patterns:
- Garbage bags: "scented" > "size" > "count"
- Car parts: "compatibility" > "position" > "brand"
- Furniture: "material" > "color" > "dimensions"

Rule-based systems require manual tuning for EACH category.
AI learns patterns from search data (clicks_rank, search_volume_rank).

THE SOLUTION:
-------------
"Let AI read the search data and decide what matters."

Instead of:
  if product == "garbage_bags": put_scent_first()
  elif product == "car_parts": put_compatibility_first()
  ...

Use:
  concepts_ranked_by_search = AI.rank(concepts, clicks_rank, search_volume_rank)
  title = AI.build_title(concepts_ranked_by_search, zones=[40,40,20])

THE PHILOSOPHY:
---------------
1. DATA DRIVES DECISIONS: Search ranks tell us what matters
2. AI GENERALIZES PATTERNS: Works across categories
3. HUMANS SET CONSTRAINTS: 40-40-20 zones, max chars, no pipes
4. AI OPTIMIZES WITHIN CONSTRAINTS: Best title for THIS product

THIS IS NOT:
- Replacing humans with AI (you set the rules)
- Black box magic (AI explains its decisions)
- Unpredictable (low temperature, structured output)

THIS IS:
- Using AI as a smart pattern-matching engine
- Replacing hardcoded if-else chains with learned behavior
- Scaling optimization across infinite product categories


================================================================================
END OF PLAN
================================================================================

SUMMARY:
The current system is over-engineered with 100+ hardcoded rules that only work
for specific categories. By replacing rule-based logic with AI agents that read
search ranking data, we can build a generalizable system that works for ANY
product while producing more natural, search-optimized titles.

The key insight: Search behavior patterns cannot be hardcoded. They must be
learned from data. AI is perfect for this task.

Next: Implement Phase 1 (AI-enhanced decisions) and test on diverse products.
